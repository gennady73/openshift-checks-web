<!DOCTYPE html>
<html lang="en">
{% block head %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/osc-web.css') }}">

    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static_ext2_blueprint.static',
          filename='cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css') }}">

    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static_ext2_blueprint.static',
          filename='cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css') }}">

    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/patternfly/3.59.3/css/patternfly.min.css') }}">

    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/patternfly/3.59.3/css/patternfly-additions.min.css') }}">

    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static_ext2_blueprint.static', filename='fonts.googleapis.com/css') + '?family=Overpass' }}">

    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.5.2/css/bootstrapValidator.min.css') }}">

    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js') }}"></script>

    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js') }}"></script>

    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/patternfly/3.59.3/js/patternfly.min.js') }}"></script>
    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js') }}"></script>

    <script src="{{ url_for('static_ext2_blueprint.static',
        filename='cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/js/bootstrap-timepicker.min.js') }}"></script>

    {# <script src="{{ url_for('static_ext2_blueprint.static',
        filename='cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.5.2/js/bootstrapValidator.min.js') }}"></script> #}

    <script src="{{ url_for('static_ext2_blueprint.static',
        filename='cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.11.9/js/validator.min.js') }}">
    </script>

    <title>{% block title %}OCChecks{% endblock %}</title>


    <script language="JavaScript">
        console.log('Script is running.');
        var loggedIn;
        function toggleLoginLogout() {
            var loginLogoutButton = document.getElementById('loginLogoutButton');

            // Use logic to determine whether the user is logged in or not
            var isLoggedIn = loggedIn === undefined? false: true;

            if (isLoggedIn) {
                // If logged in, perform logout action
                window.location.href = "/logout";
            } else {
                // If not logged in, perform login action
                window.location.href = "/login";
            }
        }

        function showProcessing() {
            var loadingIcon = document.getElementById('loading-icon');
            loadingIcon.style.display = 'inline';  // Show the loading icon

            // Show "Processing" notification
            showNotification('Processing...');
        }

        function showNotification(message) {
            var notificationElement = document.getElementById('notification');
            notificationElement.innerHTML = message + ' <span id="timestamp">' + getCurrentTimestamp() + '</span>';
            notificationElement.style.display = 'block';
        }

        function getCurrentTimestamp() {
            var now = new Date();
            var hours = now.getHours().toString().padStart(2, '0');
            var minutes = now.getMinutes().toString().padStart(2, '0');
            var seconds = now.getSeconds().toString().padStart(2, '0');
            return hours + ':' + minutes + ':' + seconds;
        }

        function hideNotification() {
            var notificationElement = document.getElementById('notification');
            notificationElement.innerHTML = '';
            notificationElement.style.display = 'none';
        }

        // Simulate async task completion after 5 seconds (adjust as needed)
        //setTimeout(function() {
        //    hideNotification();
        //    showNotification('Completed');
        //}, 5000);

        // handler for cluster selection combo
        $(document).ready(function () {
            $('#cluster-select').on('change', function () {
              const selectedCluster = $(this).val();
              $.ajax({
                url: '/login-cluster',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ cluster: selectedCluster }),
                success: function (data) {

                  if (data.status === 'success') {
                    console.log("Logged into cluster:", data.selected);
                  } else {
                    console.error("Login failed:", data.error);
                  }
                },
                error: function (jqXHR) {
                  console.error("AJAX error:", jqXHR.responseText);
                }
              });
            });

          $('#submit-btn').on('click', function () {
            const clusterName = $('#cluster-select').val();

            $('#loading-icon').show();
            $('#submit-btn').prop('disabled', true);

            $.ajax({
              url: '/async-task',
              method: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({ cluster: clusterName }),
              success: function (html) {
              debugger;
                //$('#result-container').html(html);  // Replace part of page
                // "home-tab-nav": home_tab_nav,
                // "result-container": result_container
                $('#home-tab-nav').html(html.home_tab_nav);
                $('#result-container').html(html.result_container);
                $('#notification').html(html.notification);
              },
              error: function (xhr, status, err) {
                console.error("AJAX error:", err);
                alert("AJAX error: " + err);
              },
              complete: function () {
                $('#loading-icon').hide();
                $('#submit-btn').prop('disabled', false);
              }
            });
          });

          // Future button logic (e.g., #deploy-btn) goes here
        });

    </script>
    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js') }}"></script>
    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static_ext2_blueprint.static',
            filename='cdnjs.cloudflare.com/ajax/libs/patternfly/3.59.3/js/patternfly.min.js') }}"></script>
</head>
<body>
<header>
    <nav class="navbar navbar-pf-vertical navbar-fixed-top">
        <div class="navbar-header">
<!--            <a class="navbar-brand" href="#"><span class="title" id="reporttitle">OpenShift Checks</span><</a> -->
            <a class="navbar-brand" id="reporttitle" href="#" style="
                min-width: 200px;
                align-self: center;
                padding: 3px 0 6px 0;
            ">
                <div class="title" style="font-weight: lighter;font-size: larger;">OpenShift</div>
                <div class="title" style="font-weight: bold;transform: translateX(30px);font-size: large;">checks</div></a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav occ-navbar-nav occ-nav">
                <li {% if active_tab=="Home" %} class="active" {% endif %}>
                    <a href="{{ url_for('home') }}" role="navigation">Home</a>
                </li>
                <li {% if active_tab=="Scheduler" %} class="active" {% endif %}>
                    <a href="{{ url_for('scheduler.scheduler_home') }}" role="navigation">Scheduler</a>
                </li>
                {# <li {% if active_tab=="Insights" %} class="active" {% endif %}>
                    <a href="{{ url_for('insights.insights_home') }}" role="navigation">Insights</a>
                </li> #}
                <li {% if active_tab=="Editor" %} class="active" {% endif %}>
                    <a href="{{ url_for('editor.code_editor_home') }}" role="navigation">Editor</a>
                </li>
                <li {% if active_tab=="HatGPT" %} class="active" {% endif %}>
                    <a href="#" role="navigation">Hat GPT</a>
                </li>
            </ul>
            {#
            <ul class="nav navbar-nav navbar-right navbar-iconic navbar-utility">
                <li class="dropdown">
                    <a href="#0" class="dropdown-toggle nav-item-iconic" id="dropdownMenu1" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="true">
                        <span title="Help" class="fa pficon-help"></span>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        <li>
                            <a target="_blank" href="local-web-resources/github.com/risuorg/risu/blob/master/README.md">Usage
                                Doc</a>
                        </li>
                        <li>
                            <a target="_blank" href="local-web-resources/github.com/risuorg/risu/tree/master/doc">Plugin
                                Development</a>
                        </li>
                        <li>
                            <a target="_blank"
                               href="local-web-resources/github.com/risuorg/risu/blob/master/CONTRIBUTING.md">Contribute</a>
                        </li>
                    </ul>
                </li>
            </ul>
            #}

            {# ### Cluster selection drop-down menu ### #}
            <ul class="nav navbar-nav occ-navbar-nav occ-nav navbar-right" style="margin-right:5px;">
<!--                <li><span style="color:#ffffff;background-color:transparent;" id="clusterName">cluster-name</span></li>-->
<!--                <li class="dropdown" value="">-->
<!--                    <a href="#0" class="dropdown-toggle nav-item" id="selectCluster" data-toggle="dropdown"-->
<!--                       aria-haspopup="true" aria-expanded="true">-->
<!--                        <span title="Select Cluster" class="active">Cluster</span>-->
<!--                        <span class="caret"></span>-->
<!--                    </a>-->
<!--                    <ul class="dropdown-menu" aria-labelledby="selectCluster">-->
<!--                        <li value="cluster-A">cluster-A</li>-->
<!--                        <li value="cluster-B">cluster-B</li>-->
<!--                        <li value="cluster-C">cluster-C</li>-->
<!--                    </ul>-->
<!--                </li>-->
                <li class="nav navbar-nav occ-navbar-nav occ-nav">
                    <span id="project-location" class="fa" style="padding-top: 12px;">
                        <select class="form-control input-small fa" id="cluster-select"
                            aria-describedby="project-location"
                            data-error="The value is empty!" data-minlength="3" required >
                            {#
                            <option value="checks-extended" {% if dirname|truncate(20)=="checks-extended" %} selected {% endif %} >
                                cluster.abc</option>
                            <option value="checks-extended" {% if dirname|truncate(20)=="checks-extended" %} selected {% endif %} disabled>
                                cluster.123</option>
                            <option value="checksroot" {% if dirname|truncate(20)=="checksroot" %} selected {% endif %} >
                                cluster.1234567890.aaaaaaaaa0.bbbbbbbbb0.ccccccccc0.ddddddddd0.eeeeeeeee0.fffffffff0.ggggggggg0</option>
                            #}
                             <option value="">select cluster</option>
                          {% for cluster in clusters %}
                            <option value="{{ cluster }}">{{ cluster }}</option>
                          {% endfor %}
                        </select>
                    </span>
                </li>
            </ul>

        </div>
    </nav>
</header>
{% endblock %}

{% block content_special %}
<!-- TAB NAV BEGIN -->
    {% include 'partials/home/tab_nav.html' %}
<!-- TAB NAV END -->
{% endblock %}

{% block content %}
    <div id="content"></div>
{% endblock %}


<footer>
    <div id="footer" class="footer-pf navbar-fixed-bottom">
        {% block footer %}
            &copy; Copyright 2023 by <a href="http://domain.invalid/">you</a>.
        {% endblock %}
    </div>
</footer>

</body>
</html>
